(this["webpackJsonpCC.LMS.WebUI"]=this["webpackJsonpCC.LMS.WebUI"]||[]).push([[38],{3074:function(e,t,o){"use strict";o.r(t);var s=o(14),i=o(15),n=o(16),c=o(17),r=o(18),a=o(12),p=o.n(a),d=o(20),u=o(27),l=o(1287),v=o(1293),h=o(1294),m=o(1031),T=o(1295),b=o(1296),L=o(1032),g=o(1033),A=o(1297),f=o(13),x=o(86),j=o(30),y=o(129),E=o(19),C=o(237),O=o(1034),k=o(159),w=(o(1035),o(1036)),S=o(731),I=o(1288),N=o(11),P={checkCanAdvanceToNextLesson:x.d.checkCanAdvanceToNextLesson,fetchLesson:x.d.fetchLesson,fetchCourses:y.d.fetchCourses,gradeInstructionTopic:x.d.gradeInstructionTopic,submitLessonFeedback:x.d.submitLessonFeedback,CLEAR_LESSON_STATE:x.a.CLEAR_LESSON_STATE,updateUserActivity:j.a.updateUserActivity,COMPOSE_MODULE:j.b.COMPOSE_MODULE,SET_A11Y_MESSAGE:j.b.SET_A11Y_MESSAGE,SET_DETACH_HEADER:j.b.SET_DETACH_HEADER},R=Object(d.b)((function(e,t){var o,s,i,n,c,r,a,p,d,u,l,v=e.lesson,h=e.shell,m=(e.admin.courseDetail,e.student),T=[v,{match:t.match}],b=v.instruction;return{courseCode:b.courseEnrollment&&b.courseEnrollment.courseCode,isGradingTopic:b.topicIdsBeingGraded.length>0,lesson:b.activeLesson,loadingLesson:!b.activeLesson||!b.resourceCacheDocument||b.activeLesson&&b.activeLesson.id!==+t.match.params.id,nextAdminLesson:b.nextAdminLesson,nextLesson:b.nextLesson,previousAdminLesson:b.previousAdminLesson,requestFeedback:b.requestFeedback,activityHasUnsavedChanges:(o=x.c).getActivityHasUnsavedChanges.apply(o,T),isExamActive:(s=x.c).getIsExamActive.apply(s,T),isLessonComplete:(i=x.c).getIsLessonComplete.apply(i,T),activeTopic:(n=x.c).getActiveTopic.apply(n,T),activeTopicActivities:(c=x.c).getActiveTopicActivities.apply(c,T),instructionTopicResources:(r=x.c).getInstructionTopicResources.apply(r,T),instructionTopics:(a=x.c).getInstructionTopicsWithStatus.apply(a,T),nextTopic:(p=x.c).getNextTopic.apply(p,T),previousTopic:(d=x.c).getPreviousTopic.apply(d,T),topicVideos:(u=x.c).getTopicVideos.apply(u,T),studentEnrollments:m.data,isContentReviewer:!t.match.params.studentId&&j.c.isContentReviewer(h),applicationError:h.applicationError,sectionId:null===(l=b.courseEnrollment)||void 0===l?void 0:l.sectionId}}),P)(Object(u.e)(function(e){Object(c.a)(o,e);var t=Object(r.a)(o);function o(){var e;Object(i.a)(this,o);for(var s=arguments.length,n=new Array(s),c=0;c<s;c++)n[c]=arguments[c];return(e=t.call.apply(t,[this].concat(n))).unblock=void 0,e.state={showLessonFeedback:!1,reviewButtonObj:{canUserAdvance:!0,reviewingLesson:!1}},e.handleTopicChange=function(t,o){if(t&&(e.props.gradeInstructionTopic(t),!e.props.match.params.topicId||+e.props.match.params.topicId!==t.id)){var s=_(e.props.location.pathname,t.id);o?e.props.history.replace(s):e.props.history.push(s);var i=Object(k.c)(t);e.props.SET_A11Y_MESSAGE("Navigated to page ".concat(t.rank+1,". ").concat(i," of lesson ").concat(e.props.lesson?e.props.lesson.name:""))}},e.goToNextTopic=function(){return e.handleTopicChange(e.props.nextTopic)},e.goToPreviousTopic=function(){return e.handleTopicChange(e.props.previousTopic)},e.navigateToStudentsNextLesson=function(){var t=e.props.nextLesson;if(t){var o=t.courseEnrollmentId,s=t.relatedLessonId;o&&s&&e.props.history.push("/student/".concat(o,"/lesson/").concat(s,"/topic"))}else e.props.history.push("/dashboard")},e.continueGoToNextLesson=function(){e.setState({showLessonFeedback:!1}),e.navigateToStudentsNextLesson()},e.goToNextLesson=function(){if(e.setState({reviewButtonObj:{canUserAdvance:!0,reviewingLesson:!1}}),e.props.isContentReviewer){if(!e.props.nextAdminLesson)return;var t=e.props.nextAdminLesson.relatedLessonId;e.props.history.push("/lesson/".concat(t,"/topic"))}else e.props.requestFeedback?e.setState({showLessonFeedback:!0}):e.navigateToStudentsNextLesson()},e.goToPreviousLesson=function(){if(e.props.isContentReviewer){if(!e.props.previousAdminLesson)return;var t=e.props.previousAdminLesson.relatedLessonId;e.props.history.push("/lesson/".concat(t,"/topic"))}},e.checkCanAdvanceToNextLesson=function(t,o){e.setState({reviewButtonObj:{reviewingLesson:!0}}),e.props.checkCanAdvanceToNextLesson(t,o).then((function(t){(t?t.lessonWasAdvanced:void 0)?window.location.reload():e.setState({reviewButtonObj:{canUserAdvance:!1,reviewingLesson:!1,result:t}})}))},e.handleKeyboardCommands=function(t){"ArrowRight"!==t.code||e.props.isExamActive||(e.props.nextTopic?e.goToNextTopic():e.props.isLessonComplete&&e.goToNextLesson()),"ArrowLeft"!==t.code||e.props.isExamActive||(e.props.previousTopic?e.goToPreviousTopic():e.props.previousAdminLesson&&e.goToPreviousLesson())},e}return Object(n.a)(o,[{key:"enablePagePrompt",value:function(){var e=this;this.unblock&&this.unblock(),this.unblock=this.props.history.block((function(t,o){if(e.props.activityHasUnsavedChanges&&!t.pathname.includes("lesson/".concat(e.props.match.params.id,"/topic")))return"You have pending work that will be lost if you navigate away, do you wish to continue?"}))}},{key:"disablePagePrompt",value:function(){this.unblock&&(this.unblock(),this.unblock=null)}},{key:"fetchLesson",value:function(e){var t=this;this.props.fetchLesson(e,this.props.match.params.studentId?+this.props.match.params.studentId:null).then((function(e){t.props.match.params.topicId||t.handleTopicChange(e,!0)}))}},{key:"sendAnalyticsPageView",value:function(){var e=this.props,t=e.courseCode,o=e.activeTopic,s=e.lesson;if(t&&o&&s){var i=o.rank,n=s.rank;C.a.sendPageView("/course/".concat(t,"/lesson/").concat(n+1,"/page/").concat(i+1))}}},{key:"componentDidMount",value:function(){this.props.COMPOSE_MODULE(this.props.theme.body.lessonBackgroundColor,!1,!0),this.fetchLesson(+this.props.match.params.id),document.addEventListener("keydown",this.handleKeyboardCommands),this.enablePagePrompt(),this.sendAnalyticsPageView(),this.props.updateUserActivity(this.props.location.pathname),this.props.fetchCourses(),Object(S.c)()&&this.props.SET_DETACH_HEADER(!0)}},{key:"componentDidUpdate",value:function(e){e.match.params.id!==this.props.match.params.id&&(this.props.CLEAR_LESSON_STATE(),this.fetchLesson(+this.props.match.params.id),this.props.COMPOSE_MODULE(this.props.theme.body.lessonBackgroundColor,!1,!0)),e.location.pathname!==this.props.location.pathname&&this.sendAnalyticsPageView()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyboardCommands),this.props.CLEAR_LESSON_STATE(),this.disablePagePrompt()}},{key:"getFormatIncompleteTopics",value:function(){return this.props.instructionTopics.filter((function(e){return e.topicStatus===E.z.Incomplete||e.topicStatus===E.z.InProgress})).map((function(e){var t=e.name.split(" "),o=Number(t[t.length-1]),s=window.location.pathname.split("/");s.pop();var i=s.join("/");return{index:o+1,url:"".concat(window.location.origin).concat(i,"/").concat(e.id),topic:e}}))}},{key:"render",value:function(){var e,t,o=this,s=this.props,i=this.state;if(s.loadingLesson||!s.lesson||!s.activeTopic)return Object(N.jsx)(f.I,{});var n=null!==(e=null===(t=s.studentEnrollments.courses.data.find((function(e){return e.sectionId===s.sectionId})))||void 0===t?void 0:t.isChatbotEnabled)&&void 0!==e&&e;return Object(N.jsxs)("div",{className:"row",style:{minHeight:"100%",marginBottom:"-2em"},children:[Object(N.jsx)(f.x,{fallback:this.renderActivityErrorAlert("Lesson instruction"),render:function(){return s.lesson&&Object(N.jsx)(A.a,{instructionTopicResources:s.instructionTopicResources,isExamActive:s.isExamActive,lesson:s.lesson,topicVideos:s.topicVideos,applicationError:s.applicationError&&s.applicationError.toString(),renderTopicCircleNavigation:function(){return Object(N.jsx)(b.a,{isContentReviewer:s.isContentReviewer,instructionTopics:s.instructionTopics,activeTopic:s.activeTopic,onTopicClick:o.handleTopicChange})}})}}),this.renderLessonTopicActivities(),this.renderFooterNavigation(),n&&Object(N.jsx)(I.a,{}),Object(N.jsx)(g.a,{skipFeedback:function(){s.submitLessonFeedback(-1),o.continueGoToNextLesson()},submitFeedback:function(e){s.submitLessonFeedback(e),o.continueGoToNextLesson()},show:i.showLessonFeedback}),Object(N.jsx)(O.a,{activeTopic:s.activeTopic,lesson:s.lesson})]})}},{key:"renderLessonTopicActivities",value:function(){var e=this,t=this.props,o={isContentReviewer:t.isContentReviewer,match:t.match};return t.activeTopicActivities.map((function(i){switch(i.activityType){case E.d.Coding:case E.d.WebExercise:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("Coding activity"),render:function(){return Object(N.jsx)(m.a,Object(s.a)({codingExerciseActivity:i},o))}},i.id);case E.d.Exam:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("Exam"),render:function(){return Object(N.jsx)(l.a,Object(s.a)({activity:i,theme:t.theme},o))}},i.id);case E.d.Project:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("Project upload activity"),render:function(){return Object(N.jsx)(T.a,Object(s.a)({activity:i},o))}},i.id);case E.d.Quiz:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("Quiz"),render:function(){return Object(N.jsx)(h.a,Object(s.a)({quizActivity:i},o))}},i.id);case E.d.WebProject:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("Web project activity"),render:function(){return Object(N.jsx)(v.a,Object(s.a)({webProjectActivity:i},o))}},i.id);case E.d.LtiTool:return Object(N.jsx)(f.x,{fallback:e.renderActivityErrorAlert("LTI Tool"),render:function(){var t,n;return Object(N.jsx)(w.a,Object(s.a)({activity:i,sectionId:null!==(t=e.props.sectionId)&&void 0!==t?t:e.props.match.params.sectionId,topicId:null===(n=e.props.activeTopic)||void 0===n?void 0:n.id},o))}},i.id);default:return null}}))}},{key:"renderFooterNavigation",value:function(){var e=this.props,t=this.getFormatIncompleteTopics();return Object(N.jsx)(L.a,{incompleteTopics:t,handleTopicChange:this.handleTopicChange,reviewButtonObj:this.state.reviewButtonObj,isContentReviewer:e.isContentReviewer,isGradingTopic:e.isGradingTopic,isLessonComplete:e.isLessonComplete,isExamActive:e.isExamActive,goToNextTopic:e.nextTopic?this.goToNextTopic:void 0,goToPreviousTopic:e.previousTopic?this.goToPreviousTopic:void 0,checkCanAdvanceToNextLesson:this.checkCanAdvanceToNextLesson,goToNextLesson:e.nextTopic||e.isContentReviewer&&!e.nextAdminLesson?void 0:this.goToNextLesson,goToPreviousLesson:!e.previousTopic&&e.previousAdminLesson?this.goToPreviousLesson:void 0})}},{key:"renderActivityErrorAlert",value:function(e){return Object(N.jsx)("div",{className:"col-md-12",children:Object(N.jsx)("div",{className:"col-md-10 col-md-offset-1",children:Object(N.jsxs)(f.d,{type:"Danger",children:[Object(N.jsxs)("p",{style:{color:"inherit"},children:[e," failed to load or has crashed. Please try again or contact support if the issue persists."]}),Object(N.jsx)(f.v,{onClick:function(){return window.location.reload()},style:{display:"block",marginTop:"0.5em"},children:"Reload Lesson"})]})})})}}]),o}(p.a.Component)));t.default=R;var _=function(e,t){var o=e.slice(0,e.indexOf("/topic"));return"".concat(o,"/topic/").concat(t)}}}]);
//# sourceMappingURL=38.44d66faa.chunk.js.map